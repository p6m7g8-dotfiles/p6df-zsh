name: Build

on:
  pull_request: {}
  workflow_dispatch: {}

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4.2.2
      - name: Install zsh
        run: sudo apt-get update; sudo apt-get install time zsh -y
      - name: Dependant Repositories
        run: |
          zsh -c '
          for repo in $(for dep in $(. ./init.zsh ; p6df::modules::zsh::deps ; echo $ModuleDeps); do echo $dep; done | cut -d: -f 1 |sort -u); do
            git clone https://github.com/$repo
          done'
      - name: Test
        env:
          P6_DFZ_SRC_P6M7G8_DOTFILES_DIR: .
          TERM: xterm
        run: zsh -e p6common/bin/p6ctl test